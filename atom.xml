<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[bpgoing的博客]]></title>
  <subtitle><![CDATA[6年+的互联网开发经验]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://blog.zhuxiaowu.com/"/>
  <updated>2016-08-26T09:25:02.000Z</updated>
  <id>http://blog.zhuxiaowu.com/</id>
  
  <author>
    <name><![CDATA[朱晓武]]></name>
    <email><![CDATA[zhuxiaowu365@gmail.com]]></email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[angular+rails局域网部署]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/08/26/angular-rails-nginx-unicron-socket-https%E9%83%A8%E7%BD%B2/"/>
    <id>http://blog.zhuxiaowu.com/2016/08/26/angular-rails-nginx-unicron-socket-https部署/</id>
    <published>2016-08-26T09:23:20.000Z</published>
    <updated>2016-08-26T09:25:02.000Z</updated>
    <content type="html"><![CDATA[<p>每次部署都能吐出一口老血！！！唉，随便写写吧，因为牵扯东西很多</p>
<p>项目前端是angularjs，后端rails，还有nodejs服务做长连接通知服务。</p>
<p>其中angularjs是单独的，用gulp做项目管理和发布，也做到了一键发布。 具体gulp如何做的网上有很多例子，就算写也可以单独拿出一篇来。</p>
<p>因为项目用到了摄像头扫码, 在chrome下扫码需要https协议才能打开摄像头, 所以nginx部署的时候增加了免费的ssl模块，如何申请请自行Google。</p>
<p>好多问题是ssl可以部署到局域网吗？ 经过实践是可以的，因为ssl似乎只针对域名绑定, 局域网内只允许域名访问服务器即可。</p>
<p>既然是局域网域名访问，要让每台机器在hosts设置域名ip映射，那你就不配称为一个程序员，所以服务器又做了DNS 解析服务，在交换机或者路由器的dns地址指到服务器地址即可访问。</p>
<p><img src="/uploads/jiance-me-deploy-xiaoguo.png" alt="效果图"></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>每次部署都能吐出一口老血！！！唉，随便写写吧，因为牵扯东西很多</p>
<p>项目前端是angularjs，后端rails，还有nodejs服务做长连接通知服务。</p>
<p>其中angularjs是单独的，用gulp做项目管理和发布，也做到了一键发布。 具体gulp如何]]>
    </summary>
    
      <category term="DNS解析" scheme="http://blog.zhuxiaowu.com/tags/DNS%E8%A7%A3%E6%9E%90/"/>
    
      <category term="angularjs" scheme="http://blog.zhuxiaowu.com/tags/angularjs/"/>
    
      <category term="https" scheme="http://blog.zhuxiaowu.com/tags/https/"/>
    
      <category term="nginx" scheme="http://blog.zhuxiaowu.com/tags/nginx/"/>
    
      <category term="rails" scheme="http://blog.zhuxiaowu.com/tags/rails/"/>
    
      <category term="socket" scheme="http://blog.zhuxiaowu.com/tags/socket/"/>
    
      <category term="ssl" scheme="http://blog.zhuxiaowu.com/tags/ssl/"/>
    
      <category term="局域网" scheme="http://blog.zhuxiaowu.com/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[html5配合canvas签名提取]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/08/11/html5-canvas-image-signature/"/>
    <id>http://blog.zhuxiaowu.com/2016/08/11/html5-canvas-image-signature/</id>
    <published>2016-08-11T07:16:52.000Z</published>
    <updated>2016-08-12T06:54:23.000Z</updated>
    <content type="html"><![CDATA[<p>做的检测系统，为了把结果打印到A4纸上时免去N个人的手写签名。</p>
<p>省事做法是把手写签名拍照交给设计处理，之后放到系统上 打印或预览时把签名放上。</p>
<p>像下面这图</p>
<p><img src="/uploads/html5-canvas-signature-original.png" alt="签名原图" title="签名原图"></p>
<p>这样做的问题不言而喻，任何修改都要交给设计再次处理。要是卖出去软件，维护起来太麻烦了。</p>
<p>为了把人工处理签名转为系统处理，想到两种解决方式。</p>
<p>一是在系统上做个写字板，每个人在写字板上写自己的签名。</p>
<p>二是把上面的签名原图上传系统，系统通过canvas把个人签名抠出来。</p>
<p>一的做法是很多OA的传统做法吧，因为网上搜索canvas制作web写字板时，大家都说为了解决签名的需求而做的写字板。</p>
<p>在这里分享几个搜到的写字板项目成果，觉得很不错。</p>
<p>最喜欢的一个 <a href="https://github.com/szimek/signature_pad" target="_blank" rel="external">https://github.com/szimek/signature_pad</a></p>
<p>这个也很酷 <a href="https://willowsystems.github.io/jSignature/" target="_blank" rel="external">https://willowsystems.github.io/jSignature/</a></p>
<p>还有这个 <a href="http://www.oschina.net/code/snippet_2352644_49974" target="_blank" rel="external">http://www.oschina.net/code/snippet_2352644_49974</a></p>
<p>这个是做水印的 <a href="http://www.sjsjw.com/101/005918MYM002927/" target="_blank" rel="external">http://www.sjsjw.com/101/005918MYM002927/</a></p>
<p>觉得这种做法其实很鸡肋，因为通过鼠标去写签名，跟笔在纸上写的太不一样了，一旦有纠纷问题，文字鉴别都鉴别不出来。。。。只能本人确定是不是自己的签名，看看效果</p>
<p><img src="/uploads/html5-canvas-signature-huaban.png" alt="画板签名" title="画板签名"></p>
<p>还有种方法就是通过电脑外设画板来写签名，俺没有，也没尝试，也不知道效果如何。只是觉得并没有方便多少。</p>
<p>所以，在这里就努力往第二种解决方式努力吧，好在网上搜到了很多牛掰的例子，搞定签名还是so easy的。</p>
<p>#####先说说思路</p>
<ol>
<li>做好上传</li>
<li>canvas拿到图片，处理成黑白</li>
<li>之后通过文字识别把正确的签名之外的部分去掉</li>
<li>重新做透明背景或白色背景</li>
</ol>
<p>#####再分享找到的例子</p>
<p>canvas+html5做的人脸识别 <a href="http://wesbos.com/html5-video-face-detection-canvas-javascript/" target="_blank" rel="external">http://wesbos.com/html5-video-face-detection-canvas-javascript/</a></p>
<p>不知道是啥 <a href="http://techslides.com/object-detection-with-html5-getusermedia" target="_blank" rel="external">http://techslides.com/object-detection-with-html5-getusermedia</a></p>
<p>图片处理 <a href="http://www.html5rocks.com/en/tutorials/canvas/imagefilters/" target="_blank" rel="external">http://www.html5rocks.com/en/tutorials/canvas/imagefilters/</a></p>
<p>#####最后把结果分享给大家<br><img src="/uploads/html5-canvas-signature-result.png" alt="处理后的结果" title="处理后的结果"></p>
<p>#####聊聊解决思路，看看解决代码</p>
<div class="mp4"><br>    <video controls preload="auto" style="max-width: 100%;"><br>        <source src="/uploads/html5-canvas-signature.mp4" type="video/mp4"><br>        <source src="/uploads/html5-canvas-signature.mp4" type="video/ogg"><br>    </video><br></div>
]]></content>
    <summary type="html">
    <![CDATA[<p>做的检测系统，为了把结果打印到A4纸上时免去N个人的手写签名。</p>
<p>省事做法是把手写签名拍照交给设计处理，之后放到系统上 打印或预览时把签名放上。</p>
<p>像下面这图</p>
<p><img src="/uploads/html5-canvas-signat]]>
    </summary>
    
      <category term="canvas" scheme="http://blog.zhuxiaowu.com/tags/canvas/"/>
    
      <category term="html5" scheme="http://blog.zhuxiaowu.com/tags/html5/"/>
    
      <category term="signature" scheme="http://blog.zhuxiaowu.com/tags/signature/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[angular依赖注入]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/07/01/angular-how-inject-style/"/>
    <id>http://blog.zhuxiaowu.com/2016/07/01/angular-how-inject-style/</id>
    <published>2016-07-01T10:28:36.000Z</published>
    <updated>2016-07-01T10:57:23.000Z</updated>
    <content type="html"><![CDATA[<p>声明一个controller有很多种写法都能运行成功, 那么各种方法的的却别是什么呢，下面咱们讲讲。</p>
<p>###推断式注入</p>
<pre><code>var testModule = angular.module(&apos;testModule&apos;, []);
testModule.controller(&apos;testCtrl&apos;, function($scope){
    // xxx
});
</code></pre><p>推断性注入是angular根据你传入的参数(这里只有$scope)来给你自动注入。</p>
<p>但是这样有个坏处, 就是如果你的代码发布的时候被压缩, $scope可能被压缩成a, 这样代码就会报错了。。</p>
<p>所以这种方式不被推荐</p>
<p>###声明式注入</p>
<pre><code>var testModule = angular.module(&apos;testModule&apos;, []);
var testCtrl = function($scope, rs){
    // 这里的rs其实就是$rootScope
}
testCtrl.$inject = [&apos;$scope&apos;, &apos;$rootScope&apos;];
testModule.controller(&apos;testCtrl&apos;, testCtrl);
</code></pre><p>就要多写一行, 别的没啥影响, 觉得这样挺好的, 还有就是随便压缩代码。</p>
<p>###内联式注入</p>
<pre><code>var testModule = angular.module(&apos;testModule&apos;, []);
testModule.controller(&apos;testCtrl&apos;, [&apos;$scope&apos;, &apos;$rootScope&apos;, function(scope, rs){
    // scope就是$scope, rs 就是rootScope
    // 当然依然可以起名叫$scope
}]);
</code></pre><p>一样可以随便压缩代码</p>
<pre><code>var testModule = angular.module(&apos;testModule&apos;, []);
testModule.factory(&apos;book&apos;, function () {
    return {
        name: &apos;程序员宝典&apos;
    }
});
testModule.controller(&apos;testCtrl&apos;, [&apos;$scope&apos;, &apos;$injector&apos;, 
    function($scope, $injector){
        $injector.invoke(function(book){
            // 这样一样可以引入book这个factory
            console.log(book.name);
        })
    }
]);
</code></pre><p>看看angular官方给的例子吧</p>
<p><a href="https://docs.angularjs.org/api/ng/function/angular.injector" target="_blank" rel="external">https://docs.angularjs.org/api/ng/function/angular.injector</a></p>
<p>今天才了解了这些玩意是个什么状态… 哈哈。 编写指令时一样</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>声明一个controller有很多种写法都能运行成功, 那么各种方法的的却别是什么呢，下面咱们讲讲。</p>
<p>###推断式注入</p>
<pre><code>var testModule = angular.module(&apos;testModule&apos;,]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用js-xlsx处理excel]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/06/26/xlsx-excel-basic/"/>
    <id>http://blog.zhuxiaowu.com/2016/06/26/xlsx-excel-basic/</id>
    <published>2016-06-26T01:33:04.000Z</published>
    <updated>2016-06-27T14:55:48.000Z</updated>
    <content type="html"><![CDATA[<p>需求：完整导入导出excel, 于是又一通Google。<br>发现了以下玩意</p>
<p>前端解析excel/nodejs也可以 <a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="external">https://github.com/SheetJS/js-xlsx</a></p>
<p>前端呈现excel样式,不过Jquery的 <a href="https://handsontable.com" target="_blank" rel="external">https://handsontable.com</a></p>
<p>如果有angular的就好了，想着ui-grid的可以, 但需要做的工作太多, 时间紧任务重, 还是拿现成的吧(不是我的风格)</p>
<h3 id="xlsx_u5165_u95E8"><a href="#xlsx_u5165_u95E8" class="headerlink" title="xlsx入门"></a>xlsx入门</h3><p>xlsx支持以下格式读取</p>
<ul>
<li>Excel 2007+ XML Formats (XLSX/XLSM)</li>
<li>Excel 2007+ Binary Format (XLSB)</li>
<li>Excel 2003-2004 XML Format (XML “SpreadsheetML”)</li>
<li>Excel 97-2004 (XLS BIFF8)</li>
<li>Excel 5.0/95 (XLS BIFF5)</li>
<li>OpenDocument Spreadsheet (ODS)</li>
</ul>
<p>支持写入文件的格式</p>
<ul>
<li>XLSX</li>
<li>CSV (and general DSV)</li>
<li>JSON and JS objects (various styles)</li>
</ul>
<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h3><p>npm安装</p>
<pre><code>npm install xlsx
</code></pre><p>浏览器引入</p>
<pre><code>&lt;script lang=&quot;javascript&quot; src=&quot;dist/xlsx.core.min.js&quot;&gt;&lt;/script&gt;
</code></pre><p>bower安装</p>
<pre><code>bower install js-xlsx
</code></pre><h3 id="u53EF_u9009_u6A21_u5757"><a href="#u53EF_u9009_u6A21_u5757" class="headerlink" title="可选模块"></a>可选模块</h3><p>node版本自动加载依赖。<br>有些模块过大，却在特定场景使用，所以没放进核心库中。为了浏览器能够使用必须引入</p>
<pre><code>&lt;!-- international support from https://github.com/sheetjs/js-codepage --&gt;
&lt;script src=&quot;dist/cpexcel.js&quot;&gt;&lt;/script&gt;
&lt;!-- ODS support --&gt;
&lt;script src=&quot;dist/ods.js&quot;&gt;&lt;/script&gt;
</code></pre><p>dist目录下生成好了压缩版本<br>包含全部功能的单文件版本dist/xlsx.full.min.js</p>
<h3 id="u4F4E_u7248_u672Cjs_u6807_u51C6_u517C_u5BB9_u6027"><a href="#u4F4E_u7248_u672Cjs_u6807_u51C6_u517C_u5BB9_u6027" class="headerlink" title="低版本js标准兼容性"></a>低版本js标准兼容性</h3><p>xlxs.js使用的ES5标准, 低版本的浏览器需要<a href="http://git.io/QVh77g" target="_blank" rel="external">Polyfills</a>支持。引入<a href="https://github.com/SheetJS/js-xlsx/blob/master/shim.js" target="_blank" rel="external">shim</a>即可</p>
<pre><code>&lt;script type=&quot;text/javascript&quot; src=&quot;/path/to/shim.js&quot;&gt;&lt;/script&gt;
</code></pre><p>要在xlxs之前加载</p>
<h3 id="u89E3_u6790Workbooks"><a href="#u89E3_u6790Workbooks" class="headerlink" title="解析Workbooks"></a>解析Workbooks</h3><p>一些概念</p>
<pre><code>workbook   指整个excel, 读取excel文件得到的对象
worksheet  指excel中的一个表, 一个excel至少一张表
cell       指单元格
</code></pre><p>node读取</p>
<pre><code>XLSX = require(&apos;xlsx&apos;);
var workbook = XLSX.readFile(&apos;test.xlsx&apos;);
</code></pre><p>ajax读取，兼容低版本的请看<a href="http://oss.sheetjs.com/js-xlsx/ajax.html" target="_blank" rel="external">http://oss.sheetjs.com/js-xlsx/ajax.html</a></p>
<pre><code>/* set up XMLHttpRequest */
var url = &quot;test_files/formula_stress_test_ajax.xlsx&quot;;
var oReq = new XMLHttpRequest();
oReq.open(&quot;GET&quot;, url, true);
oReq.responseType = &quot;arraybuffer&quot;;

oReq.onload = function(e) {
    var arraybuffer = oReq.response;

    /* convert data to binary string */
    var data = new Uint8Array(arraybuffer);
    var arr = new Array();
    for(var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
    var bstr = arr.join(&quot;&quot;);

    /* Call XLSX */
    var workbook = XLSX.read(bstr, {type:&quot;binary&quot;});

    /* DO SOMETHING WITH workbook HERE */
}
oReq.send();
</code></pre><p>HTML5拖拽，使用readAsBinaryString读取</p>
<pre><code>/* set up drag-and-drop event */
function handleDrop(e) {
    e.stopPropagation();
    e.preventDefault();
    var files = e.dataTransfer.files;
    var i,f;
    for (i = 0, f = files[i]; i != files.length; ++i) {
        var reader = new FileReader();
        var name = f.name;
        reader.onload = function(e) {
            var data = e.target.result;

            /* if binary string, read with type &apos;binary&apos; */
            var workbook = XLSX.read(data, {type: &apos;binary&apos;});

            /* DO SOMETHING WITH workbook HERE */
        };
        reader.readAsBinaryString(f);
    }
}
drop_dom_element.addEventListener(&apos;drop&apos;, handleDrop, false);
</code></pre><p>HTML5 输入框使用readAsBinaryString读取</p>
<pre><code>function handleFile(e) {
    var files = e.target.files;
    var i,f;
    for (i = 0, f = files[i]; i != files.length; ++i) {
        var reader = new FileReader();
        var name = f.name;
        reader.onload = function(e) {
            var data = e.target.result;

            var workbook = XLSX.read(data, {type: &apos;binary&apos;});

            /* DO SOMETHING WITH workbook HERE */
        };
        reader.readAsBinaryString(f);
    }
}
input_dom_element.addEventListener(&apos;change&apos;, handleFile, false);
</code></pre><p>真累…<br>记些要点</p>
<p>###接口</p>
<pre><code>XLSX.utils.encode_row(0)                             -&gt; &apos;1&apos;
XLSX.utils.decode_row(&apos;1&apos;)                           -&gt; 0
XLSX.utils.encode_col(4)                             -&gt; &apos;E&apos;
XLSX.utils.decode_col(&apos;E&apos;)                           -&gt; 4
XLSX.utils.encode_cell({c:0,r:2})                    -&gt; &apos;A3&apos;
XLSX.utils.decode_cell(&apos;C4&apos;)                         -&gt; { c: 2, r: 3 }
XLSX.utils.encode_range({s:{c:0,r:1},e:{c:2,r:4}})   -&gt; &apos;A2:C5&apos;
XLSX.utils.decode_range(&apos;A5:C6&apos;)                     -&gt; {s:{c:0,r:4},e:{c:2,r:5}}
</code></pre><p>###Workbook / Worksheet / Cell 对象描述</p>
<p>####一般结构<br>这样表示一个单元格地址 {c:C, r:R}, 大写C和R是0开始的索引值。B5单元格的表示方法就是{c:1, r:4} c就是列, r就是行。</p>
<p>这样表示一个单元格范围 {s:S, e:E}, 范围里S是第一个单元格, E是最后一个单元格。像A3:B7对应就是{s:{c:0, r:2}, e:{c:1, r:6}}。这样就知道哪些单元格是合并的了</p>
<p>单元格对象</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>v</code></td>
<td>raw value (see Data Types section for more info)</td>
</tr>
<tr>
<td><code>w</code></td>
<td>格式化文本 (如果支持)</td>
</tr>
<tr>
<td><code>t</code></td>
<td>数据类型: <code>b</code> Boolean, <code>n</code> 数字, <code>e</code> 错误, <code>s</code> 字符串, <code>d</code> 日期</td>
</tr>
<tr>
<td><code>f</code></td>
<td>公式 (如果支持)</td>
</tr>
<tr>
<td><code>r</code></td>
<td>富文本编码 (如果支持, node读出来似乎不支持, 乱码)</td>
</tr>
<tr>
<td><code>h</code></td>
<td>HTML 渲染的富文本 (如果支持)</td>
</tr>
<tr>
<td><code>c</code></td>
<td>comments associated with the cell ** 没见过</td>
</tr>
<tr>
<td><code>z</code></td>
<td>number format string associated with the cell (if requested)</td>
</tr>
<tr>
<td><code>l</code></td>
<td>单元格的链接地址 (.Target holds link, .tooltip is tooltip)</td>
</tr>
<tr>
<td><code>s</code></td>
<td>the style/theme of the cell (if applicable)单元格样式(支持有限)</td>
</tr>
</tbody>
</table>
<p>###Worksheet Object<br>这些特殊字段都以!开头</p>
<p>!ref 表格的范围</p>
<p>最后的最后发现对样式的支持完全没有…. 看issues也是….唉。</p>
<p>隆重介绍一下这个fork</p>
<p><a href="https://github.com/protobi/js-xlsx" target="_blank" rel="external">https://github.com/protobi/js-xlsx</a></p>
<p>一下安静了。。。谁用谁知道</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>需求：完整导入导出excel, 于是又一通Google。<br>发现了以下玩意</p>
<p>前端解析excel/nodejs也可以 <a href="https://github.com/SheetJS/js-xlsx" target="_blank" rel="exte]]>
    </summary>
    
      <category term="js-xlsx" scheme="http://blog.zhuxiaowu.com/tags/js-xlsx/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[html5配合摄像头实现扫码]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/06/21/html5-camera-barcode-scan-1d-2d/"/>
    <id>http://blog.zhuxiaowu.com/2016/06/21/html5-camera-barcode-scan-1d-2d/</id>
    <published>2016-06-21T05:17:33.000Z</published>
    <updated>2016-06-30T03:08:30.000Z</updated>
    <content type="html"><![CDATA[<p>管理项目，需要扫码，像超市一样。本想着买个扫码枪，jd一看这个贵呀。。操作还麻烦，web管理系统，还得绑定keydown之类的乱七八糟，算了。</p>
<p>由于知道高版本浏览器支持拍照，添加上扫码应该不麻烦，就一通Google。下面看看例子吧</p>
<p>目前觉得最好用的1d解码应该是这个</p>
<p><a href="https://github.com/EddieLa/JOB" target="_blank" rel="external">https://github.com/EddieLa/JOB</a> 记得gh-pages分支</p>
<p>最好用的2d解码是这个</p>
<p><a href="https://github.com/LazarSoft/jsqrcode" target="_blank" rel="external">https://github.com/LazarSoft/jsqrcode</a> 还好在线例子能运行起来</p>
<p>不用支持上传图片解码,那就把没用的代码删掉得了。</p>
<p>还遇到了问题，angular下开启视频居然有报错</p>
<pre><code>Refused to load media from &apos;blob:http%3A//localhost%3A3000/0fde46b7-3913-47e3-8941-1a85a6ab99c8&apos; because it violates the following Content Security Policy directive: &quot;default-src *&quot;. Note that &apos;media-src&apos; was not explicitly set, so &apos;default-src&apos; is used as a fallback.

undefined:1 Uncaught (in promise) DOMException: Failed to load because no supported source was found.
</code></pre><p>这么解决 index.html里注释上一行,加下一行</p>
<pre><code>&lt;!-- &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src *; style-src &apos;self&apos; &apos;unsafe-inline&apos;; script-src &apos;self&apos; &apos;unsafe-inline&apos; &apos;unsafe-eval&apos;&quot;&gt; --&gt;
&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;script-src &apos;self&apos; http://localhost:3000 &apos;unsafe-inline&apos; &apos;unsafe-eval&apos;;&quot;&gt;
</code></pre><p>看看这俩</p>
<p><a href="https://github.com/meteor/meteor/tree/devel/packages/browser-policy" target="_blank" rel="external">https://github.com/meteor/meteor/tree/devel/packages/browser-policy</a></p>
<p><a href="https://github.com/meteor/mobile-packages/issues/80" target="_blank" rel="external">https://github.com/meteor/mobile-packages/issues/80</a></p>
<p>还有这俩, 我用的第一个最简单的，不喜欢太复杂，坑爹。</p>
<p><a href="https://github.com/jonashartmann/webcam-directive" target="_blank" rel="external">https://github.com/jonashartmann/webcam-directive</a></p>
<p><a href="https://github.com/onemightyroar/angular-camera" target="_blank" rel="external">https://github.com/onemightyroar/angular-camera</a></p>
<p><a href="https://github.com/bcabanes/ng-camera" target="_blank" rel="external">https://github.com/bcabanes/ng-camera</a></p>
<p>等两天放上例子, 在页面直接可以扫码</p>
<p>有任何问题请留言。</p>
<p>演示效果<br>js上传后总被处理坏…所以没办法上demo, 需要源码的留言吧</p>
<script>
    // var video = document.getElementById('video');
    // var canvas = document.getElementById('barcode-canvas');
    // canvas.width = 640;
    // canvas.height = 480;
    // context = canvas.getContext("2d");
    // var doDecode = true;
    // function success2D(result){
    //     doDecode = false;
    //     console.log(result);
    // }
    // DecoderWorker = new Worker("/javascripts/barcode1d.min.js");
    // DecoderWorker.onmessage = function(result){
    //     // 解析相同, 还要排错是不是ID
    //     if(result.data.success == "localization") {
    //         return;
    //     }
    //     if(result.data.success != 'localization' && result.data.result.length > 0){
    //         doDecode = false;
    //         console.log(result.data.result);
    //     }
    // };
    // // 解码
    // var barcodeScan = function(){
    //     if(doDecode){
    //         try{
    //             context.drawImage(video, 0, 0, canvas.width, canvas.height);
    //             qrcode.width = canvas.width;
    //             qrcode.height = canvas.height;
    //             qrcode.imagedata = context.getImageData(0, 0, canvas.width, canvas.height);
    //             try{
    //                 DecoderWorker.postMessage({ // 解析一维码
    //                     scan : context.getImageData(0, 0, canvas.width, canvas.height).data,
    //                     scanWidth : canvas.width,
    //                     scanHeight : canvas.height,
    //                     multiple : true,
    //                     decodeFormats : ["Code128","Code93","Code39","EAN-13", "2Of5", "Inter2Of5", "Codabar"],
    //                     cmd : "normal",
    //                     rotation : 1,
    //                 });
    //                 success2D(qrcode.process(context));// 解析二维码
    //             } catch(e){}
    //         } catch(e){}
    //     }
    // }

    // navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
    // if (navigator.getUserMedia) {
    //     navigator.getUserMedia({video: true, audio: false}, function(stream) {
    //         video.src = window.URL.createObjectURL(stream);
    //         video.play();
    //         setInterval(barcodeScan, 500);
    //     }, function(error) {
    //         console.log("打开视频错误: " + error);
    //     });
    // } else {
    //     console.log("不支持打开视频, 请联系管理员");
    // }
</script>]]></content>
    <summary type="html">
    <![CDATA[<p>管理项目，需要扫码，像超市一样。本想着买个扫码枪，jd一看这个贵呀。。操作还麻烦，web管理系统，还得绑定keydown之类的乱七八糟，算了。</p>
<p>由于知道高版本浏览器支持拍照，添加上扫码应该不麻烦，就一通Google。下面看看例子吧</p>
<p>目前觉得最好用]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[angular-ui-router 嵌套路由]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/05/28/angular-ui-router-simple-learn/"/>
    <id>http://blog.zhuxiaowu.com/2016/05/28/angular-ui-router-simple-learn/</id>
    <published>2016-05-28T08:27:59.000Z</published>
    <updated>2016-05-28T08:29:15.000Z</updated>
    <content type="html"><![CDATA[<p>稍等, 后续</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>稍等, 后续</p>
]]>
    </summary>
    
      <category term="angular-ui-router" scheme="http://blog.zhuxiaowu.com/tags/angular-ui-router/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[ionic框架的一些图片扩展]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/03/19/ionic-image-picker/"/>
    <id>http://blog.zhuxiaowu.com/2016/03/19/ionic-image-picker/</id>
    <published>2016-03-19T07:03:37.000Z</published>
    <updated>2016-03-19T07:21:08.000Z</updated>
    <content type="html"><![CDATA[<p>做的这个ionic应用, 主要是图片的展示, 在找插件时发现很少能有合意的, 所以准备项目完成后自己写个好了</p>
<h3 id="u56FE_u7247_u753B_u5ECA_3F"><a href="#u56FE_u7247_u753B_u5ECA_3F" class="headerlink" title="图片画廊?"></a>图片画廊?</h3><p><a href="https://github.com/pedroabreu/ion-gallery" target="_blank" rel="external">https://github.com/pedroabreu/ion-gallery</a></p>
<p>这里主要是图片的modal view跟插件合在了一起</p>
<h3 id="u56FE_u7247_u5F02_u6B65_u52A0_u8F7D"><a href="#u56FE_u7247_u5F02_u6B65_u52A0_u8F7D" class="headerlink" title="图片异步加载"></a>图片异步加载</h3><p>看到过有个ionic-lazy-load-image 但并不好用, 具体为什么没细看，但看到了这个不错</p>
<p><a href="http://www.bennadel.com/blog/2498-lazy-loading-image-with-angularjs.htm" target="_blank" rel="external">http://www.bennadel.com/blog/2498-lazy-loading-image-with-angularjs.htm</a></p>
<h3 id="u672A_u52A0_u8F7D_u65F6_u56FE_u7247_u7684_u5360_u4F4D_u7B26"><a href="#u672A_u52A0_u8F7D_u65F6_u56FE_u7247_u7684_u5360_u4F4D_u7B26" class="headerlink" title="未加载时图片的占位符"></a>未加载时图片的占位符</h3><p><a href="http://maketea.co.uk/2013/05/04/responsive-image-placeholders.html" target="_blank" rel="external">http://maketea.co.uk/2013/05/04/responsive-image-placeholders.html</a></p>
<p>这个挺好的，但是图片做为瀑布流或者尺寸不固定时简单的几个css是不够的，这个应该配合图片的异步加载一起</p>
<h3 id="u8FD8_u6709_u4E9B_u5176_u4ED6_u7684_u4E1C_u897F"><a href="#u8FD8_u6709_u4E9B_u5176_u4ED6_u7684_u4E1C_u897F" class="headerlink" title="还有些其他的东西"></a>还有些其他的东西</h3><p>如何判断一个DOM元素在当前视口中可见？</p>
<p><a href="http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433" target="_blank" rel="external">http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport/7557433#7557433</a><br>这个还是不错的</p>
<h4 id="u518D_u6765_u4E2A_u7EA7_u8054_u83DC_u5355_u5427"><a href="#u518D_u6765_u4E2A_u7EA7_u8054_u83DC_u5355_u5427" class="headerlink" title="再来个级联菜单吧"></a>再来个级联菜单吧</h4><p>就叫 cascade-picker<br><a href="https://github.com/minh8023/ionic-citypicker" target="_blank" rel="external">https://github.com/minh8023/ionic-citypicker</a> 这是省市级联菜单, 肯定基于这样的来做, 暂且记录一下。</p>
<p>同时也要参考ionic-datepicker来做, 有modal效果和popup效果才够意思</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>做的这个ionic应用, 主要是图片的展示, 在找插件时发现很少能有合意的, 所以准备项目完成后自己写个好了</p>
<h3 id="u56FE_u7247_u753B_u5ECA_3F"><a href="#u56FE_u7247_u753B_u5ECA_3F" clas]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[Ionic Hybrid App调用Camera+读取相册照片]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/02/19/ionic-angularjs-cordova-camera-development/"/>
    <id>http://blog.zhuxiaowu.com/2016/02/19/ionic-angularjs-cordova-camera-development/</id>
    <published>2016-02-19T12:56:37.000Z</published>
    <updated>2016-02-24T11:47:09.000Z</updated>
    <content type="html"><![CDATA[<p>前两天把开发环境搭建好了，但是Cordova是基于浏览器内核来渲染UI的(不知道这么说对不对，具体啥样也没去细弄)，不管基不基于浏览器，基于App的功能设计总得有些需要解决的问题，下面列一列，一个一个去解决。</p>
<p>1 首先是授权登陆，服务端已经写好了rest api，授权是基于token认证的</p>
<p>2 第三方授权登陆</p>
<p>3 分享功能, 起码能分享到微信，微博，QQ吧。还在找插件中，没试。</p>
<p>4 Android检查版本更新，自动检查</p>
<p>5 拍照，选取照片，上传服务器</p>
<p>先开始解决Camera 相册 上传滴问题吧，相机效果怎么着也要像这样吧？</p>
<p><img src="/uploads/camera-demo.png" alt="demo"></p>
<p>第一创建个cameraDemo项目</p>
<pre><code>ionic start cameraDemo tabs
</code></pre><p>安装3个插件</p>
<pre><code>cordova plugin add cordova-plugin-camera # 调用相机的
cordova plugin add https://github.com/wymsee/cordova-imagePicker.git # 打开相册的
cordova plugin add cordova-plugin-file-transfer # 文件上传的
</code></pre><p>之后到<a href="http://ngcordova.com/" target="_blank" rel="external">http://ngcordova.com/</a>这里下载ngcordova, 解压后把dist目录的ng-cordova.js 或者 ng-cordova.min.js 拷贝到项目的www/js目录。这是官方安装教程<a href="http://ngcordova.com/docs/install/" target="_blank" rel="external">http://ngcordova.com/docs/install/</a></p>
<p>接着在index.html里引用</p>
<pre><code>&lt;script src=&quot;lib/ngCordova/dist/ng-cordova.js&quot;&gt;&lt;/script&gt; # 这是新添加，在cordova.js之前
&lt;script src=&quot;cordova.js&quot;&gt;&lt;/script&gt;
</code></pre><p>修改www/js/app.js 引入ngCordova模块</p>
<p><img src="/uploads/include-ng-cordova.png" alt="demo"></p>
<p>剩下的代码就不写了，看这里有具体的例子</p>
<p><a href="http://ngcordova.com/docs/plugins/camera/" target="_blank" rel="external">http://ngcordova.com/docs/plugins/camera/</a></p>
<p><a href="http://ngcordova.com/docs/plugins/imagePicker/" target="_blank" rel="external">http://ngcordova.com/docs/plugins/imagePicker/</a></p>
<p><a href="http://ngcordova.com/docs/plugins/fileTransfer/" target="_blank" rel="external">http://ngcordova.com/docs/plugins/fileTransfer/</a></p>
<p>最终结果就是这样</p>
<p><img src="/uploads/camera-xiaoguo.png" alt="demo"></p>
<p>虽然跟文章开始时最终效果差了些，但咱们开局是好的，文章开始时的效果应该需要相机的二次开发，所以路还很长，要学习的还很多呀。</p>
<p>不过网上看到了这个例子<a href="https://davidwalsh.name/browser-camera" target="_blank" rel="external">https://davidwalsh.name/browser-camera</a>，应该可以用HTML5来定制相机界面，但是有很多局限性，像聚焦，前后摄像头，闪光灯开启关闭等等。。。我是没尝试，有愿意试的小伙伴希望给个反馈。。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>前两天把开发环境搭建好了，但是Cordova是基于浏览器内核来渲染UI的(不知道这么说对不对，具体啥样也没去细弄)，不管基不基于浏览器，基于App的功能设计总得有些需要解决的问题，下面列一列，一个一个去解决。</p>
<p>1 首先是授权登陆，服务端已经写好了rest ap]]>
    </summary>
    
      <category term="App Camera" scheme="http://blog.zhuxiaowu.com/tags/App-Camera/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[angularjs ionic实现用户认证]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/02/16/user-auth-angularjs-ionic/"/>
    <id>http://blog.zhuxiaowu.com/2016/02/16/user-auth-angularjs-ionic/</id>
    <published>2016-02-16T07:15:19.000Z</published>
    <updated>2016-02-24T11:37:58.000Z</updated>
    <content type="html"><![CDATA[<p>年后开始尝试用ionic来做个移动App，之前也列出了需要解决的问题，今天算是把UI都搞的差不多了，接着就把权限认证也搞上吧。<br>一通Google+乱问搜罗到了这篇文章，先不管行不行，直接翻译了再说(按照自己的意思翻译的)，不行咱们再找别的方案。</p>
<p>原文地址 <a href="https://devdactic.com/user-auth-angularjs-ionic/" target="_blank" rel="external">https://devdactic.com/user-auth-angularjs-ionic/</a></p>
<p>原作者说：在Ionic+AngularJS做的Hybrid App中实现登陆和用户认证系统是大家遇到的最难的问题之一，他之前写过一个简单的登陆<a href="https://devdactic.com/simple-login-example-with-ionic-and-angularjs/" target="_blank" rel="external">simple login with Ionic and AngularJS</a>居然是每天访问最多的(反正我没看到，这里是作者写的文章里被浏览最多的)。所以作者又有了奉献精神，当当当，写出了这篇完整的权限认证系统！在此小弟感谢，要不您的文章我还得再花几天时间捣鼓！ O(∩_∩)O</p>
<p>认证系统嘛，从以下三个角度来一一解决</p>
<ol>
<li>用户登陆和会话保持(后端基于token认证)。</li>
<li>基于路由的授权控制</li>
<li>会话失效，重新登陆</li>
</ol>
<p>这里提供了一份完整的源代码 <a href="/uploads/devdactic-authentication.zip" title="原网站下载下来的">点击下载</a>，一个基于Ionic框架开发的，但大多数只是AngularJS逻辑，所以不论你想要用到AngularJS App 还是 Hybrid App都没问题，接着往下看吧。还有需要一个后端程序，这是原作者关于后端写的一篇文章 <a href="https://devdactic.com/restful-api-user-authentication-1/" target="_blank" rel="external">RESTful API User Authentication with Node.js and AngularJS</a>。</p>
<h3 id="u51C6_u5907_u5DE5_u4F5C"><a href="#u51C6_u5907_u5DE5_u4F5C" class="headerlink" title="准备工作"></a>准备工作</h3><p>首先创建个Ionic项目，关于Ionic的开发环境可以看<a href="http://blog.zhuxiaowu.com/2016/02/12/ionic-angularjs-cordova-env-development/">Ionic+Angularjs+PhoneGap开发环境搭建</a></p>
<pre><code>$ ionic start devdactic-auth blank
$ cd devdactic-auth
$ bower install angular-mocks --save # 经测试这玩意不用装，没啥用，就是模拟请求的。
</code></pre><p>打开项目，找到<code>www/js</code>目录，创建3个文件，分别是<code>controllers.js</code> <code>services.js</code>和<code>constants.js</code>。</p>
<p>之后在index.html引入</p>
<pre><code>&lt;script src=&quot;js/controllers.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/services.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/constants.js&quot;&gt;&lt;/script&gt;
&lt;!-- 
如果直接源码下载angular-mocks.js
并且放到了www/lib/ionic/js/angular/angular-mocks.js
那么就不用在此引入。
--&gt;
&lt;script src=&quot;lib/angular-mocks/angular-mocks.js&quot;&gt;&lt;/script&gt;
</code></pre><p>还要修改<code>www/js/app.js</code>文件，引入angular-mocks模块</p>
<pre><code>angular.module(&apos;starter&apos;, [&apos;ionic&apos;, &apos;ngMockE2E&apos;])
</code></pre><p>再创建5个HTML文件放到 www/templates目录(没有此目录自行创建)，分别是 <code>login.html</code>, <code>main.html</code>, <code>dashboard.html</code>, <code>public.html</code>, <code>admin.html</code>。</p>
<p>OK，准备工作就这些，下面开始愉(苦)快(逼)的编码吧。</p>
<h3 id="u5728APP_u91CC_u521B_u5EFA_u4E00_u4E9B_u5E38_u91CF"><a href="#u5728APP_u91CC_u521B_u5EFA_u4E00_u4E9B_u5E38_u91CF" class="headerlink" title="在APP里创建一些常量"></a>在APP里创建一些常量</h3><p>在创建route之前，需要先定义一些在全局常量，这样比用事件广播或者字符串定义的角色要简单。 编辑<code>www/js/constants.js</code>文件</p>
<pre><code>angular.module(&apos;starter&apos;)

.constant(&apos;AUTH_EVENTS&apos;, {
    notAuthenticated: &apos;auth-not-authenticated&apos;,
    notAuthorized: &apos;auth-not-authorized&apos;
})

.constant(&apos;USER_ROLES&apos;, {
    admin: &apos;admin_role&apos;,
    public: &apos;public_role&apos;
});
</code></pre><p>很简单，现在我们就可以在程序中使用这些常量了。并且看到了这个 <a href="https://medium.com/opinionated-angularjs/techniques-for-authentication-in-angularjs-applications-7bbf0346acec#.xyr6n5u82" target="_blank" rel="external">AngularJS中的身份验证应用程序的技术</a>, 感谢！</p>
<h3 id="u5F00_u59CB_u521B_u5EFA_u89C6_u56FE"><a href="#u5F00_u59CB_u521B_u5EFA_u89C6_u56FE" class="headerlink" title="开始创建视图"></a>开始创建视图</h3><p>程序包含一个登录页面和3个tab选项的布局，这些tab页都是需要身份验证，所以没登录前不能访问任何tab页面。就算在浏览器里运行，也不能直接通过URL来访问这些tab页面，这样才是确保你应用是最安全的。</p>
<p>编辑<code>www/index.html</code>的body标签</p>
<pre><code>&lt;body ng-app=&quot;starter&quot; ng-controller=&quot;AppCtrl&quot;&gt;
    &lt;ion-nav-bar class=&quot;bar-balanced&quot;&gt;
    &lt;/ion-nav-bar&gt;
    &lt;ion-nav-view&gt;&lt;/ion-nav-view&gt;
&lt;/body&gt;
</code></pre><p>我们有一个导航栏(ion-nav-bar标签)和导航视图(ion-nav-view)元素将显示视图连接到路由，为了让程序尽快运行就先在创建个全部空的controllers。</p>
<p>编辑<code>www/js/controllers.js</code></p>
<pre><code>angular.module(&apos;starter&apos;)

.controller(&apos;AppCtrl&apos;, function() {})
.controller(&apos;LoginCtrl&apos;, function() {})
.controller(&apos;DashCtrl&apos;, function() {});
</code></pre><p>接着是登录页面，就创建两个input+一个登录按钮。</p>
<p>编辑<code>www/templates/login.html</code></p>
<pre><code>&lt;ion-view view-title=&quot;Sign-In&quot; name=&quot;login-view&quot;&gt;
    &lt;ion-content class=&quot;padding&quot;&gt;
        &lt;div class=&quot;list list-inset&quot;&gt;
            &lt;label class=&quot;item item-input&quot;&gt;
                &lt;input type=&quot;text&quot; placeholder=&quot;Username&quot; ng-model=&quot;data.username&quot;&gt;
            &lt;/label&gt;
            &lt;label class=&quot;item item-input&quot;&gt;
                &lt;input type=&quot;password&quot; placeholder=&quot;Password&quot; ng-model=&quot;data.password&quot;&gt;
            &lt;/label&gt;
        &lt;/div&gt;
        &lt;button class=&quot;button button-block button-positive&quot; ng-click=&quot;login(data)&quot;&gt;Login&lt;/button&gt;
    &lt;/ion-content&gt;
&lt;/ion-view&gt;
</code></pre><p>下一个是登陆后的抽象视图，用于登录后的选项卡，并负责加载视图(这个只可意会，白话文我不太会讲，可能没太理解，有大神讲的比较清晰的跟俺留个言呗)。</p>
<blockquote>
<p>这里解释一下angular-ui-router的 abstract(抽象视图)属性</p>
<p>我的理解是abstract抽象视图不能直接被激活，但是可以设置为被激活的子节点。</p>
<p>就像你在A页面填入一些内容，但内容太多，有一项需要新打开一个B页面去选择，如果现在直接跳转到B页面，填写完成后再回到A页面，你就会发现一些问题(像A页面原来填写内容没有了)，那么这个时候你需要设置B页面为<code>abstract: ture</code>就不会再存在此问题了。</p>
</blockquote>
<p>编辑<code>www/templates/main.html</code></p>
<pre><code>&lt;ion-view&gt;
    &lt;ion-tabs class=&quot;tabs-icon-top tabs-balanced&quot;&gt;

        &lt;ion-tab title=&quot;Dashboard&quot; icon=&quot;ion-home&quot; href=&quot;#/main/dash&quot;&gt;
            &lt;ion-nav-view name=&quot;dash-tab&quot;&gt;&lt;/ion-nav-view&gt;
        &lt;/ion-tab&gt;

        &lt;ion-tab title=&quot;Public&quot; icon=&quot;ion-earth&quot; href=&quot;#/main/public&quot;&gt;
            &lt;ion-nav-view name=&quot;public-tab&quot;&gt;&lt;/ion-nav-view&gt;
        &lt;/ion-tab&gt;

        &lt;ion-tab title=&quot;Secret&quot; icon=&quot;ion-nuclear&quot; href=&quot;#/main/admin&quot;&gt;
            &lt;ion-nav-view name=&quot;admin-tab&quot;&gt;&lt;/ion-nav-view&gt;
        &lt;/ion-tab&gt;

    &lt;/ion-tabs&gt;
&lt;/ion-view&gt;
</code></pre><p>当用户登陆后，将跳转到Dashboard页面，页面中包含一个提示文字，一个注销按钮和3个其他请求的按钮。现在还不能运行，因为控制器和services.js还没写好(快点呗，真啰嗦，天朝程序猿就喜欢简单粗暴直接的)，但是view写好了，所以我们尽快看下我们程序吧(您也知道要快点了。。)</p>
<p>编辑<code>www/templates/dashboard.html</code></p>
<pre><code>&lt;ion-view view-title=&quot;Dashboard&quot; name=&quot;dashboard-view&quot;&gt;
    &lt;ion-nav-buttons side=&quot;right&quot;&gt;
        &lt;button class=&quot;button icon-left ion-log-out button-stable&quot; ng-click=&quot;logout()&quot;&gt;Logout&lt;/button&gt;
    &lt;/ion-nav-buttons&gt;
    &lt;ion-content class=&quot;padding&quot;&gt;
        &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col text-center&quot;&gt;
                &lt;h3 class=&quot;title&quot;&gt;Welcome !&lt;/h3&gt;
                This could be your Dashboard.
                &lt;br&gt;&lt;br&gt;&lt;br&gt;
                &lt;button class=&quot;button button-full button-positive&quot; ng-click=&quot;performValidRequest()&quot;&gt;
                    Make Valid Request
                &lt;/button&gt;
                &lt;button class=&quot;button button-full button-energized&quot; ng-click=&quot;performUnauthorizedRequest()&quot;&gt;
                    Make Request for unauthorized resource
                &lt;/button&gt;
                &lt;button class=&quot;button button-full button-assertive&quot; ng-click=&quot;performInvalidRequest()&quot;&gt;
                    Make Request without valid token
                &lt;/button&gt;
                &lt;br&gt;&lt;br&gt;
                
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/ion-content&gt;
&lt;/ion-view&gt;
</code></pre><p>其他两个视图(<code>public.html</code>, <code>admin.html</code>)是基于用于角色保护的，所以视图只包含你看到的。<br>编辑 <code>www/templates/public.html</code></p>
<pre><code>&lt;ion-view view-title=&quot;Public&quot; name=&quot;dashboard-view&quot;&gt;
    &lt;ion-content class=&quot;padding&quot;&gt;
        任何登陆的人都能看到！
    &lt;/ion-content&gt;
&lt;/ion-view&gt;
</code></pre><p>最后是这个<code>www/templates/admin.html</code>，并且只有管理员才能看到！</p>
<pre><code>&lt;ion-view view-title=&quot;Admin&quot; name=&quot;dashboard-view&quot;&gt;
    &lt;ion-content class=&quot;padding&quot;&gt;
        管理员才能看到的地方！
    &lt;/ion-content&gt;
&lt;/ion-view&gt;
</code></pre><p>全部view就这些了，到现在还没啥特别的，就是一般程序。主要还是后面的程序，咱们继续，下面是路由，算是跟程序的一个照面。</p>
<h3 id="u5B9E_u73B0_u57FA_u672C_u8DEF_u7531"><a href="#u5B9E_u73B0_u57FA_u672C_u8DEF_u7531" class="headerlink" title="实现基本路由"></a>实现基本路由</h3><p>这个demo的路由不是很复杂，一个登陆页面，一个有三个选项卡的页面，其中<code>main</code>这个抽象路由是抽象路线的模板，还有3个<code>main.*</code>对应的是3个选项页面。</p>
<p>这里主要介绍一个地方是37-39行，链接管理员选项卡。这里做了权限控制，只有当用户<strong>USER_ROLES.admin</strong>时才可以访问这些页面。现在还不能正常运行，咱们接着往下走。</p>
<p>编辑<code>www/js/app.js</code></p>
<pre><code>.config(function ($stateProvider, $urlRouterProvider, USER_ROLES) {
    $stateProvider
    .state(&apos;login&apos;, {
        url: &apos;/login&apos;,
        templateUrl: &apos;templates/login.html&apos;,
        controller: &apos;LoginCtrl&apos;
    })
    .state(&apos;main&apos;, {
        url: &apos;/&apos;,
        abstract: true,
        templateUrl: &apos;templates/main.html&apos;
    })
    .state(&apos;main.dash&apos;, {
        url: &apos;main/dash&apos;,
        views: {
            &apos;dash-tab&apos;: {
                templateUrl: &apos;templates/dashboard.html&apos;,
                controller: &apos;DashCtrl&apos;
            }
        }
    })
    .state(&apos;main.public&apos;, {
        url: &apos;main/public&apos;,
        views: {
            &apos;public-tab&apos;: {
                templateUrl: &apos;templates/public.html&apos;
            }
        }
    })
    .state(&apos;main.admin&apos;, {
        url: &apos;main/admin&apos;,
        views: {
            &apos;admin-tab&apos;: {
                templateUrl: &apos;templates/admin.html&apos;
            }
        },
        data: {
            authorizedRoles: [USER_ROLES.admin]
        }
    });

    // Thanks to Ben Noblet!
    $urlRouterProvider.otherwise(function ($injector, $location) {
        var $state = $injector.get(&quot;$state&quot;);
        $state.go(&quot;main.dash&quot;);
    });
})
</code></pre><p>现在程序里已经进入了angular-mocks，所以可以添加很多东西到程序。添加以下内容到<code>www/js/app.js</code>，咱们运行看看结果。(译者去掉所有angular-mocks的东西就成功了)</p>
<pre><code>.run(function($httpBackend){
    $httpBackend.whenGET(/templates\/\w+.*/).passThrough();
})
</code></pre><p><img src="/uploads/auth-simple-demo.png" alt="权限认证简单demo" title="auth simple demo"></p>
<h3 id="u540E_u7AEF_u6DFB_u52A0_u7528_u6237_u8BA4_u8BC1_u670D_u52A1"><a href="#u540E_u7AEF_u6DFB_u52A0_u7528_u6237_u8BA4_u8BC1_u670D_u52A1" class="headerlink" title="后端添加用户认证服务"></a>后端添加用户认证服务</h3><p>存储服务端token或者session-id使用localStorage，请求时把token放在http的头<code>$http.defaults.headers.common[&#39;X-Auth-Token&#39;] = &#39;token&#39;</code></p>
<p>编辑<code>services.js</code></p>
<pre><code>angular.module(&apos;starter&apos;)

.service(&apos;AuthService&apos;, function($q, $http, USER_ROLES) {
    var LOCAL_TOKEN_KEY = &apos;&apos;;
    var username = &apos;&apos;;
    var isAuthenticated = false; // 是否已授权
    var role = &apos;&apos;;
    var authToken;

    function loadUserCredentials() {
        var token = window.localStorage.getItem(LOCAL_TOKEN_KEY);
        if (token) {
            useCredentials(token);
        }
    }

    function storeUserCredentials(token) {
        window.localStorage.setItem(LOCAL_TOKEN_KEY, token);
        useCredentials(token);
    }

    function useCredentials(token) {
        username = token.split(&apos;.&apos;)[0];
        isAuthenticated = true;
        authToken = token;

        if (username == &apos;admin&apos;) {
            role = USER_ROLES.admin
        }
        if (username == &apos;user&apos;) {
            role = USER_ROLES.public
        }

        // Set the token as header for your requests!
        $http.defaults.headers.common[&apos;X-Auth-Token&apos;] = token;
    }

    function destroyUserCredentials() {
        authToken = undefined;
        username = &apos;&apos;;
        isAuthenticated = false;
        $http.defaults.headers.common[&apos;X-Auth-Token&apos;] = undefined;
        window.localStorage.removeItem(LOCAL_TOKEN_KEY);
    }

    var login = function(name, pw) {
        return $q(function(resolve, reject) {
            if ((name == &apos;admin&apos; &amp;&amp; pw == &apos;1&apos;) || (name == &apos;user&apos; &amp;&amp; pw == &apos;1&apos;)) {
                // Make a request and receive your auth token from your server
                storeUserCredentials(name + &apos;.yourServerToken&apos;);
                resolve(&apos;Login success.&apos;);
            } else {
                reject(&apos;Login Failed.&apos;);
            }
        });
    };

    var logout = function() {
        destroyUserCredentials();
    };

    var isAuthorized = function(authorizedRoles) {
        if (!angular.isArray(authorizedRoles)) {
            authorizedRoles = [authorizedRoles];
        }
        return (isAuthenticated &amp;&amp; authorizedRoles.indexOf(role) !== -1);
    };

    loadUserCredentials();

    return {
        login: login,
        logout: logout,
        isAuthorized: isAuthorized,
        isAuthenticated: function() {return isAuthenticated;},
        username: function() {return username;},
        role: function() {return role;}
    };
})
</code></pre><p>像之前说的，我们不能检查token是否有效，所以我们设置一个拦截器，当用一个无效的token请求，拦截器会注意到$http响应的错误，并且播放一条消息到app。</p>
<p>所以还要在<code>services.js</code>添加以下内容。</p>
<pre><code>.factory(&apos;AuthInterceptor&apos;, function ($rootScope, $q, AUTH_EVENTS) {
    return {
        responseError: function (response) {
            $rootScope.$broadcast({
                401: AUTH_EVENTS.notAuthenticated,
                403: AUTH_EVENTS.notAuthorized
            }[response.status], response);
            return $q.reject(response);
        }
    };
})

.config(function ($httpProvider) {
    $httpProvider.interceptors.push(&apos;AuthInterceptor&apos;);
});
</code></pre><p>虽然这个请求是全局的配置，但依然需要控制器来配合</p>
<pre><code>.controller(&apos;AppCtrl&apos;, function($scope, $state, $ionicPopup, AuthService, AUTH_EVENTS) {
    $scope.username = AuthService.username();

    $scope.$on(AUTH_EVENTS.notAuthorized, function(event) {
        var alertPopup = $ionicPopup.alert({
            title: &apos;Unauthorized!&apos;,
            template: &apos;You are not allowed to access this resource.&apos;
        });
    });

    $scope.$on(AUTH_EVENTS.notAuthenticated, function(event) {
        AuthService.logout();
        $state.go(&apos;login&apos;);
        var alertPopup = $ionicPopup.alert({
            title: &apos;Session Lost!&apos;,
            template: &apos;Sorry, You have to login again.&apos;
        });
    });

    $scope.setCurrentUsername = function(name) {
        $scope.username = name;
    };
})
</code></pre><p>notAuthorized事件告知用户权限不足,notAuthenticated事件是token过期需要登录等。之后又设置了个当前用户，这可以使用所有的子范围!</p>
<p>之后是LoginCtrl</p>
<pre><code>.controller(&apos;LoginCtrl&apos;, function($scope, $state, $ionicPopup, AuthService) {
    $scope.data = {};

    $scope.login = function(data) {
        AuthService.login(data.username, data.password).then(function(authenticated) {
            $state.go(&apos;main.dash&apos;, {}, {reload: true});
            $scope.setCurrentUsername(data.username);
        }, function(err) {
            var alertPopup = $ionicPopup.alert({
                title: &apos;Login failed!&apos;,
                template: &apos;Please check your credentials!&apos;
            });
        });
    };
})
</code></pre><p>接着是DashCtrl</p>
<pre><code>.controller(&apos;DashCtrl&apos;, function($scope, $state, $http, $ionicPopup, AuthService) {
    $scope.logout = function() {
        AuthService.logout();
        $state.go(&apos;login&apos;);
    };

    $scope.performValidRequest = function() {
        $http.get(&apos;http://localhost:8100/valid&apos;).then(
            function(result) {
                $scope.response = result;
            });
    };

    $scope.performUnauthorizedRequest = function() {
        $http.get(&apos;http://localhost:8100/notauthorized&apos;).then(
            function(result) {
                // No result here..
            }, function(err) {
                $scope.response = err;
            });
    };

    $scope.performInvalidRequest = function() {
        $http.get(&apos;http://localhost:8100/notauthenticated&apos;).then(
            function(result) {
                // No result here..
            }, function(err) {
                $scope.response = err;
            });
    };
});
</code></pre><h3 id="u62E6_u622A_u6240_u6709_u6539_u53D8_u7684_u72B6_u6001"><a href="#u62E6_u622A_u6240_u6709_u6539_u53D8_u7684_u72B6_u6001" class="headerlink" title="拦截所有改变的状态"></a>拦截所有改变的状态</h3><p>现在没有任何检查用户的状态，这就意味着用户可以改变其URL来访问想要访问的页面。这时需要添加路由更改事件.</p>
<p>编辑 app.js 最下方添加</p>
<pre><code>.run(function ($rootScope, $state, AuthService, AUTH_EVENTS) {
    $rootScope.$on(&apos;$stateChangeStart&apos;, function (event,next, nextParams, fromState) {
        if (&apos;data&apos; in next &amp;&amp; &apos;authorizedRoles&apos; in next.data) {
            var authorizedRoles = next.data.authorizedRoles;
            if (!AuthService.isAuthorized(authorizedRoles)) {
                event.preventDefault();
                $state.go($state.current, {}, {reload: true});
                $rootScope.$broadcast(AUTH_EVENTS.notAuthorized);
            }
        }
        if (!AuthService.isAuthenticated()) {
            if (next.name !== &apos;login&apos;) {
                event.preventDefault();
                $state.go(&apos;login&apos;);
            }
        }
    });
});
</code></pre><p>译者试验了，的确很好用，但是有些地方并不合意。待俺先加上后端服务，修改修改再上来更新吧！！</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>年后开始尝试用ionic来做个移动App，之前也列出了需要解决的问题，今天算是把UI都搞的差不多了，接着就把权限认证也搞上吧。<br>一通Google+乱问搜罗到了这篇文章，先不管行不行，直接翻译了再说(按照自己的意思翻译的)，不行咱们再找别的方案。</p>
<p>原文地址]]>
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[Ionic+Angularjs+PhoneGap开发环境搭建]]></title>
    <link href="http://blog.zhuxiaowu.com/2016/02/12/ionic-angularjs-cordova-env-development/"/>
    <id>http://blog.zhuxiaowu.com/2016/02/12/ionic-angularjs-cordova-env-development/</id>
    <published>2016-02-12T07:00:35.000Z</published>
    <updated>2016-02-24T11:46:41.000Z</updated>
    <content type="html"><![CDATA[<p>开场前先絮叨絮叨<br>之前做了个关于摄影的产品，自己包揽前后左右端，凡是能不能自己解决的都自己来解决了，自己累够呛，好在是做了出来还学习了不少的经验，这不为了丰富产品，又开始搞起了APP，真是把自己往火坑里推。产品在这里</p>
<p>既然要做APP了，Android和IOS那是一个都少不了，但咱对APP开发的经验完全是零，从头学起似乎不适合我这懒人，又不舍得花钱让别人做(关键没啥必要)，只有在自己有限的知识范围内搜索可用的了。之前看到过PhoneGap和不少前端框架(现在一个找不到了)，觉得现在手机配置都高，用PhoneGap做应该问题不大，于是就开始网上各种Google，最后确定了这个Ionic+Angularjs。好吧，絮叨的也不好玩，写写咋搭建环境吧</p>
<p>本人是Mac OS X 系统，以下全部以Mac为例，其实Ubuntu也都差不多。<br>在安装了Xcode(Ubuntu安装Android开发环境)后</p>
<p>1 安装Homebrew，这玩意类似Ubuntu的 apt-get</p>
<pre><code>ruby -e &quot;$(curl -fsSL https://raw.github.com/mxcl/homebrew/go/install)&quot;
</code></pre><p>2 安装Nodejs(真是哪都有你)</p>
<pre><code>brew install nodejs
</code></pre><p>3 安装Cordova Ionic</p>
<pre><code>npm install -g cordova ionic
</code></pre><p>完成，就是这么简单，接着创建个简单的项目试试</p>
<pre><code>ionic start demo tabs
</code></pre><p>添加需要生成的应用框架</p>
<pre><code>cd demo
ionic platform add ios
ionic platform add android
</code></pre><p>最后运行</p>
<pre><code>ionic serve # 网页版本开发调试环境
ionic run ios # 运行IOS环境
ionic run android # 运行Android环境
ionic run ios -l -c -s --debug # 这个是啥就看提示吧 ionic run ios --help
</code></pre><p>用ionic开发APP需要学习Angularjs，不知道这几天能不能坚持学下去呐。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>开场前先絮叨絮叨<br>之前做了个关于摄影的产品，自己包揽前后左右端，凡是能不能自己解决的都自己来解决了，自己累够呛，好在是做了出来还学习了不少的经验，这不为了丰富产品，又开始搞起了APP，真是把自己往火坑里推。产品在这里</p>
<p>既然要做APP了，Android和I]]>
    </summary>
    
      <category term="Angularjs" scheme="http://blog.zhuxiaowu.com/tags/Angularjs/"/>
    
      <category term="Cordova" scheme="http://blog.zhuxiaowu.com/tags/Cordova/"/>
    
      <category term="Ionic" scheme="http://blog.zhuxiaowu.com/tags/Ionic/"/>
    
      <category term="PhoneGap" scheme="http://blog.zhuxiaowu.com/tags/PhoneGap/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[一个简单的项目架构]]></title>
    <link href="http://blog.zhuxiaowu.com/2015/05/01/a-simple-system-architecture/"/>
    <id>http://blog.zhuxiaowu.com/2015/05/01/a-simple-system-architecture/</id>
    <published>2015-05-01T11:38:17.000Z</published>
    <updated>2016-05-28T09:11:01.000Z</updated>
    <content type="html"><![CDATA[<p>说学习sails好久了, 之所以想学它, 只是因为原来做rails时被它各种蹩脚玩意给折腾的。</p>
<p>有些人很喜欢rails, 开始我也很喜欢, 各种库, 各种支持, 加上优雅的语法。熟悉后就各种烦各种不想用, 这货真是啥玩意都往里加, 啥新东西都想支持, 不再像它刚开始时的那么纯粹, 简便。 啥时候rails的组件能像sails那样醒目, 库能像glup提倡的那样: 每个插件只完成一个功能就好了, 别做万能的Rambo好不！！！</p>
<p>额， 这仅限于4.x及以前版本, 好久没用过了是不是有了变化不知道, 希望能变轻点吧。</p>
<p>说回正题, 最近有个基于web的实验室管理系统项目, 想了想系统的复杂性, 还有管理系统的使用习惯, 准备使用以下架构</p>
<p>关于b/s的管理系统, 可以参考<a href="https://github.com/xufei/blog/blob/master/posts/2014-04-27-%E5%9F%BA%E4%BA%8EAngularJS%E7%9A%84%E4%BC%81%E4%B8%9A%E8%BD%AF%E4%BB%B6%E5%89%8D%E7%AB%AF%E6%9E%B6%E6%9E%84.md" target="_blank" rel="external">这篇文章</a>看看</p>
<p>看完文章就该说说架构了, 以前总觉得架构高大上, 现在看也就这样, 适合项目就最好。</p>
<p>前端: bootstrap+angular+jquery+socket.io+gulp</p>
<p>后端: node+sails+mysql(mongodb), 因为没啥访问速度要求, 把默认依赖redis的组件改成mysql(真是没一个框架是满意的)</p>
<p>装上sails后看了看，这货也不是很满意, 库的依赖是grunt管理的, 这个先不管吧。 但是自己又封装了socket.io, 人家已经写这么好了, 你居然又画蛇添足。。悲催！！ 依赖的ejs模板引擎还好, 去掉也方便。再具体的还没看，慢慢完善吧，总比rails好些, 项目结构清晰, 业务复杂后也不是把所有功能集中在model, 还支持websocket。</p>
<p>先想好页面布局, 大概是这样子的, 项目管理系统嘛, 单页面项目没有刷新最实用, angular+angular-ui-router配合简直了(当然还有像<a href="http://cn.vuejs.org/" target="_blank" rel="external">vue.js</a>也不错)。 还有<a href="https://github.com/xufei/ng-control/issues/2" target="_blank" rel="external">这篇文章</a>可参考。</p>
<p>关于angular-ui-router可以单独写篇文章介绍</p>
<p><img src="/uploads/tsdsysglxt.png" alt="页面基本布局"></p>
<p>后续再补</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>说学习sails好久了, 之所以想学它, 只是因为原来做rails时被它各种蹩脚玩意给折腾的。</p>
<p>有些人很喜欢rails, 开始我也很喜欢, 各种库, 各种支持, 加上优雅的语法。熟悉后就各种烦各种不想用, 这货真是啥玩意都往里加, 啥新东西都想支持, 不再像它]]>
    </summary>
    
      <category term="angular" scheme="http://blog.zhuxiaowu.com/tags/angular/"/>
    
      <category term="sails" scheme="http://blog.zhuxiaowu.com/tags/sails/"/>
    
      <category term="language" scheme="http://blog.zhuxiaowu.com/categories/language/"/>
    
  </entry>
  
</feed>
